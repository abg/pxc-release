#!/bin/bash

set -o errexit
set -o nounset

## PXC
tar --directory="${BOSH_INSTALL_TARGET}" --extract \
  --file pxc/Percona-XtraDB-Cluster_8.0.*.tar.gz \
  --strip-components=1

# PXC 8 is built with numa support which requires libnuma
# libnuma.so is not installed in the stemcell.
# Install it, but copy it into /var/vcap/packages so mysqld will start cleanly
apt-get update && apt-get install -y libnuma1
cp /usr/lib/x86_64-linux-gnu/libnuma.so.1 "${BOSH_INSTALL_TARGET}/lib/private/"

libldap=$(ldconfig -p | awk '/libldap/ {print $NF}')
ln -s "${libldap}" "${BOSH_INSTALL_TARGET}/lib/private/libldap_r-2.4.so.2"
